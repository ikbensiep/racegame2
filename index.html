<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RAECGAEM2</title>
  <link rel="stylesheet" href="css/style.css" type="text/css"/>
  <script src="https://unpkg.com/peerjs@1.5.5/dist/peerjs.min.js"></script>
  <link rel="shortcut icon" href="favicon.svg" type="image/svg" />
</head>
<body>
  <section id="camera-viewport" data-post-processing="off">
    <main id="canvas" class="world">
      <!-- this is for dev only so we can 'live paint' the svg while developing -->
      <!-- eventually we'll only dislpay the map as a css background image!-->
      <div id="light-layer"></div>
      <div id="worldmap"></div>
    </main>
  </section>
  <label for="debugger" style="position: fixed; z-index: 10000; padding: 1ex; filter:brightness(.25) invert(.5);">
    üõ†Ô∏è debugger
  </label>
    <input type="checkbox" name="debugger" id="debugger" />
  <aside id="debug">

  </aside>
  
  <dialog id="lobby-dialog">
    <form method="dialog" id="player-setup-form">
      <h2>üèÅ Join Race</h2>
      
      <div class="input-group">
        <label for="p-name">Name</label>
        <input type="text" id="player-name" value="Kees" placeholder="Racer" maxlength="20" required autofocus>
      </div>

      <div class="input-group" style="position: relative; height: 256px; width: 256px">
        <span id="player-id-wrap">
          <label for="player-number">Driver number</label>
          <label for="player-color">Paint job</label>
          <input type="color" id="player-color" value="hotpink" list="color-palette" />
          <input type="number" id="player-number" value="67" min="0" max="99" placeholder="99" required>
        </span>
        <datalist id="color-palette">
          
          
          <option value="#ff6e61">#ff6e61</option>;
          <option value="#ffcb5c">#ffcb5c</option>;
          <option value="#69af4b">#69af4b</option>;
          <option value="#4b91e2">#4b91e2</option>;
          <option value="#ee5d5d">#ee5d5d</option>;
          
          
          <option value="#1b1e37">#1b1e37</option>;
          <option value="#4d4a8c">#4d4a8c</option>;
          <option value="#a4a4d6">#a4a4d6</option>;
          <option value="#e1b8ff">#e1b8ff</option>;
          <option value="#ff7142">#ff7142</option>;
          
          
          <option value="#ff6e61">#ff6e61</option>;
          <option value="#6c5b80">#6c5b80</option>;
          <option value="#88d8b1">#88d8b1</option>;
          <option value="#f7b5a1">#f7b5a1</option>;
          <option value="#ff9d00">#ff9d00</option>;
          
          
          <!-- ja lachn maar helaas zijn het wat viezige kleuren bijelkaar in √©√©n palet
          <option>#a55</option>
          <option>#ac1d1c</option>
          <option>#b4d455</option>
          <option>#b00b00</option>
          <option>#c0ff33</option>
          <option>#c0ffee</option>
          <option>#deface</option>
          <option>#defec8</option>
          <option>#facade</option>
          <option>#0ff1ce</option>
          -->
        </datalist>

        <style id="fixme-sobad">
          #player-id-wrap {
            position: absolute;
            cursor: pointer;
            background: url(/assets/cars/default/interior-scaled.png);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: grid;
            grid-template-columns: auto 2rem;
            height: 256px;
            width: 256px;
            will-change: transform;
            
            transition: .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);

            &:has(:focus) {
                rotate: -90deg;
            }

            #player-number {
              grid-area: 1 / 1 / -1 / -1;
              z-index: 2;
              width: 3rem;
              text-align: center;
              transform: rotate(90deg);
              height: 2rem;
              place-self: center end;
              font-weight: bold;
              font-size: 18px;
              padding: 0;
              border-top-width: 5px;
              text-indent: 1ex;
            }
            #player-color { 
              grid-area: 1 / 1 / -1 / -1;
              height: 100%;
              width: 100%;
              border: none;
              padding: 0;
              mask-image: url('/assets/cars/porsche/porsche-mask.png');
              mask-size: contain;
              mask-repeat: no-repeat;
              mask-position: center;
            }
            label {
              &[for="player-number"] {
                grid-area: 1 / 1 / -1 / -1;
                place-self: end;
              }
              &[for="player-color"] {
                grid-area: 1 / 1 / -1 / -1;
                place-self: start;
              }
            }
          }
          
        </style>

        <script>
          let colorInput = document.querySelector('#player-color');
          let options = [...document.querySelector('#color-palette').options];
          let color = options[Math.floor(options.length * Math.random())].value;
          document.body.style.setProperty('--player-color', color);
          colorInput.value = color;

          colorInput.addEventListener('input', (e) => {
            document.body.style.setProperty('--player-color', e.target.value);
          });

        </script>
      </div>
      <div class="input-group">
        <label for="track-assen">
          <input name="track" type="radio" id="track-assen" value="assen" required />
          Assen
        </label>
        <label for="track-monaco">
          <input name="track" type="radio" id="track-monaco" value="monaco" required />
          Monaco
        </label>
      </div>

      <button type="submit" id="start-race-btn" >START RACE</button>
    </form>
  </dialog>

  <template id="racecar">
    <div class="vehicle car racecar">
      <div class="car-body">
        <i class="chassis"><i class="interior"></i></i>

        <!-- bodywork stack: -->
        <!-- (all layers below are masked)-->
        <!-- filter fx (fire emitter, displacement filter)-->
        <!-- weathering / damage layers: (masked layers, blend: multi) research masking by contents? -->
        <!-- mods (spoilers) -->
        <!-- no? / default / custom livery, ::before, ::after (driver badge) -->
        <!-- .base-color (--player-color) ::before(gloss / metallic shading) radial gradient w/ splash of white, blend:multiply?, metallic: optionally masked by slight noise? (experiment)-->

        <i class="bodywork">
          <i class="base-color"></i>
          <i class="livery" data-drivernum></i>
          <i class="mods"></i>
        </i>
      </div>
    </div>
  </template>

  <template id="structure">
    <div class="structure building">
      <div class="wall-n"></div>
      <div class="wall-e"></div>
      <div class="wall-s"></div>
      <div class="wall-w"></div>
      <div class="roof"></div>
    </div>
  </template>

  <template id="shrubbery">
    <b>
      <span class="card"></span>
      <span class="card"></span5214>
    </b>
  </template>

  <svg id="filters">
          <filter id="displacementFilter">
            <feTurbulence type="fractalNoise" baseFrequency="0.05" numOctaves="2" seed="3" result="turbulence">
                <animate attributeName="seed" from="0" to="600" begin="0s" dur="100s" repeatCount="indefinite"></animate>
            </feTurbulence>

            <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="10" xChannelSelector="R" yChannelSelector="G">
            </feDisplacementMap>
          </filter>
          
          <filter id="specularLight"
            style="color-interpolation-filters:sRGB;"
            inkscape:label="Specular Light"
            x="-0.050315805"
            y="-0.050315805"
            width="1.1006316"
            height="1.1006316">
          <feGaussianBlur
                in="SourceAlpha"
                stdDeviation="10"
                result="blur"
                id="feGaussianBlur67" />
          <feSpecularLighting
                in="blur"
                specularExponent="35.0"
                specularConstant="10"
                surfaceScale="5"
                lighting-color="#fce48d"
                result="specular"
                id="feSpecularLighting67">
              <feDistantLight
                    azimuth="270"
                    elevation="156"
                    id="feDistantLight67" />
          </feSpecularLighting>
          <feComposite
                in="specular"
                in2="SourceGraphic"
                k3="1"
                k2="1"
                operator="arithmetic"
                result="composite1"
                id="feComposite67" />
          <feComposite
              in="composite1"
              in2="SourceAlpha"
              operator="in"
              result="composite2"
              id="feComposite68" />
          </filter>
            <filter id="water-loop" x="0" y="0" width="100%" height="100%">
    
    <!-- 1. Noice -->
    <feTurbulence 
      type="fractalNoise" 
      baseFrequency="0.02 0.04" 
      numOctaves="2" 
      stitchTiles="stitch" 
      result="noise" />

    <!-- 2. Shift colors for perfect loop without jump -->
    <feColorMatrix in="noise" type="hueRotate" values="0" result="animatedNoise">
      <animate 
        attributeName="values" 
        from="0" to="360" 
        dur="8s" 
        repeatCount="indefinite" />
    </feColorMatrix>

    <!-- 3. Afflpy distortion to input image -->
    <feDisplacementMap 
      in="SourceGraphic" 
      in2="animatedNoise" 
      scale="15" 
      xChannelSelector="R" 
      yChannelSelector="G" />
  </filter>


  </svg>
  <script src="js/main.js" type="module"></script>
</body>
</html>